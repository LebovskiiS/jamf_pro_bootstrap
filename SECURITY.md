# Jamf Pro Bootstrap API Security

> **Detailed information about security, encryption, and best practices**

---

## Table of Contents

- [Security Overview](#security-overview)
- [Data Encryption](#data-encryption)
- [Authentication](#authentication)
- [API Protection](#api-protection)
- [Database Security](#database-security)
- [Security Monitoring](#security-monitoring)
- [Vulnerabilities](#vulnerabilities)
- [Report Issue](#report-issue)

---

## Security Overview

**Jamf Pro Bootstrap API** implements a multi-layered security system to protect corporate data and ensure confidentiality of employee information.

### Security Principles

- **Encryption at all levels** - data is encrypted during transmission and storage
- **Principle of least privilege** - minimal access rights
- **Defense in Depth** - multi-layered protection
- **Audit and monitoring** - comprehensive operation logging
- **Secret rotation** - regular key updates

---

## Data Encryption

### CRM Request Encryption

#### Encryption Algorithm
- **Algorithm**: Fernet (AES-128 in CBC mode)
- **Key**: 32-byte key generated by PBKDF2
- **Salt**: Fixed salt for compatibility
- **Iterations**: 100,000 for PBKDF2

#### Encryption Process

```python
# 1. Generate key via PBKDF2
kdf = PBKDF2HMAC(
    algorithm=hashes.SHA256(),
    length=32,
    salt=b'jamf_bootstrap_salt',
    iterations=100000,
)
key = base64.urlsafe_b64encode(kdf.derive(encryption_key.encode()))

# 2. Encrypt data
fernet = Fernet(key)
encrypted_data = fernet.encrypt(json_data.encode())
```

#### Encrypted Data Structure

```
CRM data → Encryption with CRM key → Encryption of key with Vault key → Transmission
```

### Key Encryption

#### Double Encryption
1. **CRM key** is encrypted with key from Vault
2. **Vault key** is stored in HashiCorp Vault
3. **API** decrypts CRM key with its own key from Vault

#### Key Algorithm
- **Algorithm**: Fernet (AES-128)
- **Vault Key**: 32-byte key from Vault
- **Security**: Keys are never transmitted in plain text

### Integrity Verification

#### SHA256 Checksum
- **Algorithm**: SHA256
- **Purpose**: Data integrity verification
- **Verification**: On every request

```python
# Generate checksum
checksum = hashlib.sha256(data.encode()).hexdigest()

# Verify integrity
def verify_checksum(data: str, checksum: str) -> bool:
    return hashlib.sha256(data.encode()).hexdigest() == checksum
```

---

## Authentication

### HashiCorp Vault AppRole

#### Authentication Mechanism
- **Method**: AppRole Authentication
- **Token TTL**: 1 hour
- **Maximum TTL**: 4 hours
- **Rotation**: Automatic

#### AppRole Setup

```bash
# Create policy
vault policy write jamf-bootstrap-policy -<<EOF
path "secret/jamf-bootstrap-*" {
  capabilities = ["read"]
}
path "secret/jamf-pro-*" {
  capabilities = ["read"]
}
path "secret/database-*" {
  capabilities = ["read"]
}
EOF

# Create AppRole
vault write auth/approle/role/jamf-bootstrap \
  token_policies="jamf-bootstrap-policy" \
  token_ttl=1h \
  token_max_ttl=4h
```

### API Tokens

#### Token Validation
- **Verification**: Each request is validated for token validity
- **Source**: Tokens stored in HashiCorp Vault
- **Rotation**: Tokens rotated automatically

#### Token Structure
```json
{
  "token": "valid-token-from-vault",
  "expires_at": "2024-01-01T12:00:00Z",
  "permissions": ["read", "write"]
}
```

---

## API Protection

### Rate Limiting

#### Request Limits
- **Limit**: 100 requests per minute per IP
- **Blocking**: 15 minutes when limit exceeded
- **Logging**: All limit exceed attempts

### CORS and Security Headers

#### CORS Settings
```python
CORS_ORIGINS = [
    "https://your-crm-domain.com",
    "https://your-admin-panel.com"
]

CORS_METHODS = ["GET", "POST"]
CORS_HEADERS = ["Content-Type", "Authorization"]
```

#### Security Headers
```python
SECURITY_HEADERS = {
    "X-Content-Type-Options": "nosniff",
    "X-Frame-Options": "DENY",
    "X-XSS-Protection": "1; mode=block",
    "Strict-Transport-Security": "max-age=31536000; includeSubDomains",
    "Content-Security-Policy": "default-src 'self'"
}
```

### Input Validation

#### Data Verification
- **JSON Schema**: Request structure validation
- **Data Types**: Strict typing
- **Sanitization**: Malicious code removal
- **Data Size**: Request size limits

---

## Database Security

### PostgreSQL Security

#### SSL Connection
- **SSL Mode**: require
- **Certificates**: Google Cloud SQL certificates
- **Verification**: Certificate verification

#### Connection Settings
```python
DATABASE_CONFIG = {
    "host": "10.79.160.3",  # Internal IP
    "port": 5432,
    "database": "jamf_bootstrap_prod",
    "user": "jamf_user",
    "password": "from-vault",
    "sslmode": "require",
    "sslcert": "/path/to/client-cert.pem",
    "sslkey": "/path/to/client-key.pem",
    "sslrootcert": "/path/to/server-ca.pem"
}
```

### Database Encryption

#### Encrypted Fields
- **payload**: Encrypted employee data (base64)
- **encrypted_key**: Encrypted key (base64)
- **checksum**: SHA256 hash for integrity verification

#### Non-encrypted Fields (for search)
- **request_id**: Request UUID
- **crm_id**: CRM system ID
- **status**: Processing status
- **created_at**: Timestamp

---

## Security Monitoring

### Security Logging

#### Events to Log
- Successful authentications
- Failed authentication attempts
- Encryption/decryption operations
- Create/update/delete records
- Suspicious activity

#### Log Format
```json
{
  "timestamp": "2024-01-01T12:00:00Z",
  "level": "INFO",
  "event": "authentication_success",
  "ip_address": "192.168.1.100",
  "user_agent": "CRM-System/1.0",
  "request_id": "abc-123-def-456",
  "details": {
    "crm_id": "crm-123",
    "department": "IT"
  }
}
```

### Security Audit

#### Regular Checks
- **Daily**: Check logs for suspicious activity
- **Weekly**: Access rights audit
- **Monthly**: Key and token rotation
- **Quarterly**: System penetration testing

#### Security Metrics
- Number of failed authentications
- API response time
- Number of encryption errors
- Vault connection status

---

## Vulnerabilities

### Known Vulnerabilities

#### No known critical vulnerabilities

System uses:
- Latest library versions
- Verified encryption algorithms
- Secure data transmission protocols
- Regular security updates

### Security Recommendations

#### For Administrators
1. **Regularly update** dependencies
2. **Monitor logs** for suspicious activity
3. **Rotate keys** every 90 days
4. **Conduct penetration testing** every 6 months
5. **Update certificates** before expiration

#### For Developers
1. **Don't store secrets** in code
2. **Use HTTPS** for all connections
3. **Validate input data**
4. **Log all operations**
5. **Test security** before deployment

---

## Report Issue

### Report Vulnerability

If you found a security vulnerability:

#### Contact Information
- **Email**: sergei@pharmacyhub.com
- **Subject**: [SECURITY] Vulnerability in Jamf Pro Bootstrap API
- **Response**: Within 24 hours

#### Information to Include
1. **Vulnerability description** - detailed problem description
2. **Reproduction steps** - step-by-step instructions
3. **Potential impact** - risk assessment
4. **Fix suggestions** - your recommendations
5. **Contact information** - for feedback

### Responsible Disclosure Policy

#### Our Commitments
- Review all vulnerability reports
- Respond within 24 hours
- Acknowledge your help in fixing
- Publish information about fixes
- Don't pursue for good faith testing

#### Your Commitments
- Don't use vulnerabilities for malicious purposes
- Don't violate data confidentiality
- Report vulnerabilities responsibly
- Give time for fixing
- Cooperate in fixing process

---

## Security Checklist

### Daily Checks
- [ ] Check logs for suspicious activity
- [ ] Monitor request count
- [ ] Check Vault connection status
- [ ] Validate SSL certificates

### Weekly Checks
- [ ] Audit user access rights
- [ ] Check token rotation
- [ ] Analyze security metrics
- [ ] Update dependencies

### Monthly Checks
- [ ] Rotate encryption keys
- [ ] Update certificates
- [ ] Check security policies
- [ ] Audit configuration

### Quarterly Checks
- [ ] System penetration testing
- [ ] Security architecture review
- [ ] Update response plans
- [ ] Team training

---

<div align="center">

**Security is our priority**

*Last updated: January 2024*

</div>
